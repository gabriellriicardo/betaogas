<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betão Gás e Água</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon/web-app-manifest-512x512.png">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <link rel="manifest" href="favicon/site.webmanifest">
    <meta name="theme-color" content="#ffffff">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .hero-bg {
            background-image: url('imagens/banner.png'); /* Caminho original da imagem do banner */
            background-repeat: no-repeat;
            background-size: cover;
            /* A linha abaixo foi ajustada para posicionar o banner abaixo do menu. 5.5rem é a altura aproximada do header. */
            background-position: center 5.5rem; 
            background-attachment: fixed; /* Efeito Parallax */
        }
        .diferenciais-bg {
            position: relative;
        }
        .cta-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1;
        }
        .cta-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -10px rgba(29, 78, 216, 0.6); /* blue-700 */
        }
        .cta-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.7s ease;
            z-index: -1;
        }
        .cta-button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        #cart-sidebar {
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        #ai-modal {
             transition: opacity 0.3s ease-in-out;
        }
        .cart-open {
            transform: translateX(0) !important;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }
        #header.scrolled, #header.mobile-menu-open {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* --- CORREÇÃO DA COR DO MENU --- */
        /* Cor inicial dos links do menu (brancos) */
        #header .nav-link {
            color: #334155;
            transition: color 0.3s ease-in-out;
        }
        /* Cor dos links do menu ao passar o mouse (estado inicial) */
        #header .nav-link:hover {
            color: #dbeafe; /* blue-200 */
        }
        /* Cor dos links quando o menu é rolado ou no mobile (cinza-escuro) */
        #header.scrolled .nav-link, #header.mobile-menu-open .nav-link {
            color: #334155; /* slate-700 */
        }
        /* Cor dos links ao passar o mouse quando o menu é rolado (azul) */
        #header.scrolled .nav-link:hover, #header.mobile-menu-open .nav-link:hover {
            color: #1d4ed8; /* blue-700 */
        }
        /* --- FIM DA CORREÇÃO --- */
        
        .reveal {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.8s cubic-bezier(0.5, 0, 0, 1), transform 0.8s cubic-bezier(0.5, 0, 0, 1);
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes cart-jump {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        .cart-jump-animation {
            animation: cart-jump 0.5s ease;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-button.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2563eb;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header id="header" class="fixed top-0 left-0 right-0 z-40 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex justify-between items-center py-4">
                <a href="#inicio" class="flex items-center space-x-2">
                    <img src="imagens/logo.png" alt="Logo Betão Gás" class="h-14 w-auto">
                </a>
                <!-- Classes de cor removidas daqui e controladas via CSS -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#diferenciais" class="font-medium transition-colors nav-link">Diferenciais</a>
                    <a href="#produtos" class="font-medium transition-colors nav-link">Produtos</a>
                    <a href="#assistente" class="font-medium transition-colors nav-link">✨ Assistente</a>
                    <a href="#unidades" class="font-medium transition-colors nav-link">Unidades</a>
                    <a href="#sobre" class="font-medium transition-colors nav-link">Nossa História</a>
                </div>
                <div class="flex items-center">
                    <button id="cart-button" class="relative p-2">
                        <!-- Classe text-white removida do ícone -->
                        <i class="fas fa-shopping-cart text-2xl nav-link"></i>
                        <span id="cart-counter" class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <!-- Mobile Menu Button -->
                    <!-- Classe text-white removida do botão -->
                    <button id="mobile-menu-button" class="md:hidden p-2 ml-2 nav-link">
                        <i id="mobile-menu-icon" class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </nav>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white/90 backdrop-blur-sm">
            <a href="#diferenciais" class="block text-center py-3 text-slate-700 font-semibold hover:bg-blue-100 mobile-nav-link">Diferenciais</a>
            <a href="#produtos" class="block text-center py-3 text-slate-700 font-semibold hover:bg-blue-100 mobile-nav-link">Produtos</a>
            <a href="#assistente" class="block text-center py-3 text-slate-700 font-semibold hover:bg-blue-100 mobile-nav-link">✨ Assistente</a>
            <a href="#unidades" class="block text-center py-3 text-slate-700 font-semibold hover:bg-blue-100 mobile-nav-link">Unidades</a>
            <a href="#sobre" class="block text-center py-3 text-slate-700 font-semibold hover:bg-blue-100 mobile-nav-link">Nossa História</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="inicio" class="hero-bg text-white pt-32 pb-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex flex-col justify-center items-center text-center">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-black uppercase tracking-tight mb-4 reveal drop-shadow-xl">
                    INDISPENSÁVEL É ABASTECER SUA FAMÍLIA
                </h1>
                <p class="text-lg md:text-2xl font-light max-w-3xl mb-10 reveal drop-shadow" style="transition-delay: 200ms;">
                    Escolha seus produtos, adicione ao carrinho e receba no conforto da sua casa. Simples, rápido e seguro!
                </p>
                <a href="#produtos" class="bg-blue-600 text-white px-10 py-4 rounded-full font-bold text-lg shadow-xl hover:bg-blue-700 cta-button inline-flex items-center space-x-3 reveal" style="transition-delay: 400ms;">
                    <i class="fas fa-store text-2xl"></i>
                    <span>Começar a Comprar</span>
                </a>
            </div>
        </section>

        <!-- Diferenciais Section -->
        <section id="diferenciais" class="py-20 sm:py-28 diferenciais-bg">
            <div class="absolute inset-0 bg-slate-900/70"></div> <!-- Overlay -->
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-white">Por que escolher a Betão Gás?</h2>
                    <p class="mt-3 text-lg text-slate-300 max-w-2xl mx-auto">Mais que uma entrega, um compromisso com você.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <div class="reveal text-center" style="transition-delay: 100ms;">
                        <div class="mx-auto mb-4 bg-white/20 backdrop-blur-sm border border-white/20 text-white rounded-full h-20 w-20 flex items-center justify-center">
                            <i class="fas fa-shipping-fast text-4xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">ENTREGA RÁPIDA</h3>
                        <p class="text-slate-300">Você liga e em até 30 minutos um botijão cheio está na sua porta.</p>
                    </div>
                    <div class="reveal text-center" style="transition-delay: 200ms;">
                        <div class="mx-auto mb-4 bg-white/20 backdrop-blur-sm border border-white/20 text-white rounded-full h-20 w-20 flex items-center justify-center">
                            <i class="fas fa-shield-alt text-4xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">Segurança em Primeiro Lugar</h3>
                        <p class="text-slate-300">Trabalhamos com as melhores marcas e seguimos rigorosamente todas as normas de segurança para sua tranquilidade.</p>
                    </div>
                    <div class="reveal text-center" style="transition-delay: 300ms;">
                        <div class="mx-auto mb-4 bg-white/20 backdrop-blur-sm border border-white/20 text-white rounded-full h-20 w-20 flex items-center justify-center">
                            <i class="fas fa-headset text-4xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">Atendimento Amigo</h3>
                        <p class="text-slate-300">Nossa equipe está sempre pronta para te atender com um sorriso no rosto e a agilidade que você merece.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Water Brands Section -->
        <section id="marcas-agua" class="py-16 bg-slate-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Variedade e Qualidade para Você</h2>
                    <p class="mt-3 text-lg text-slate-600 max-w-2xl mx-auto">Trabalhamos com as melhores marcas de água mineral para garantir sua hidratação.</p>
                    <div class="mt-10 flex justify-center items-center gap-8 sm:gap-16">
                        <img src="imagens/olhodagua.png" alt="Logo Fonte Olho D'Água" class="h-16 sm:h-20 object-contain">
                        <img src="imagens/lustral.png" alt="Logo Lustral" class="h-16 sm:h-20 object-contain">
                    </div>
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section id="produtos" class="py-20 sm:py-28 bg-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Nossos Produtos</h2>
                    <p class="mt-3 text-lg text-slate-600 max-w-2xl mx-auto">Qualidade e variedade para todas as suas necessidades.</p>
                </div>
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Product cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Gemini AI Planner Section -->
        <section id="assistente" class="py-20 sm:py-28 bg-slate-800 text-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold">✨ Assistente Betão Gás</h2>
                    <p class="mt-3 text-lg text-slate-300 max-w-2xl mx-auto">Use nossas ferramentas inteligentes para facilitar seu dia a dia.</p>
                </div>
                <div class="max-w-4xl mx-auto bg-slate-700 p-2 rounded-2xl shadow-2xl reveal">
                    <!-- Tabs -->
                    <div class="flex flex-col sm:flex-row rounded-xl bg-slate-600">
                        <button data-tab="gas-duration" class="tab-button flex-1 p-4 font-bold rounded-lg active">Duração do Gás</button>
                        <button data-tab="recipe" class="tab-button flex-1 p-4 font-bold rounded-lg">Gerador de Receitas</button>
                        <button data-tab="hydration" class="tab-button flex-1 p-4 font-bold rounded-lg">Consumo de Água</button>
                    </div>
                    <!-- Tab Content -->
                    <div class="p-6">
                        <!-- Gas Duration Estimator -->
                        <div id="gas-duration-tab-content" class="tab-content-item">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="gas-people" class="block text-xs font-bold mb-1">Pessoas em casa:</label>
                                    <input type="number" id="gas-people" min="1" value="3" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                </div>
                                <div>
                                    <label for="gas-frequency" class="block text-xs font-bold mb-1">Frequência de Uso:</label>
                                    <select id="gas-frequency" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                        <option value="diariamente">Diariamente</option>
                                        <option value="algumas vezes na semana" selected>Algumas vezes na semana</option>
                                        <option value="raramente">Raramente</option>
                                    </select>
                                </div>
                            </div>
                            <button id="calculate-gas-duration" class="w-full bg-orange-500 text-white p-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-orange-600 cta-button">
                                <i class="fas fa-clock"></i> Estimar Duração do Gás
                            </button>
                        </div>
                        <!-- Recipe Generator -->
                        <div id="recipe-tab-content" class="tab-content-item hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="recipe-type" class="block text-xs font-bold mb-1">Tipo de Refeição:</label>
                                    <select id="recipe-type" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                        <option value="Almoço">Almoço</option>
                                        <option value="Jantar" selected>Jantar</option>
                                        <option value="Lanche">Lanche</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="recipe-ingredient" class="block text-xs font-bold mb-1">Ingrediente Principal:</label>
                                    <input type="text" id="recipe-ingredient" value="Frango" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                </div>
                            </div>
                             <button id="generate-recipe" class="w-full bg-red-500 text-white p-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-red-600 cta-button">
                                <i class="fas fa-utensils"></i> Gerar Receita
                            </button>
                        </div>
                         <!-- Hydration Calculator -->
                        <div id="hydration-tab-content" class="tab-content-item hidden">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label for="hydro-adults" class="block text-xs font-bold mb-1">Adultos:</label>
                                    <input type="number" id="hydro-adults" min="1" value="2" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                </div>
                                <div>
                                    <label for="hydro-children" class="block text-xs font-bold mb-1">Crianças:</label>
                                    <input type="number" id="hydro-children" min="0" value="1" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                </div>
                                <div>
                                    <label for="hydro-activity" class="block text-xs font-bold mb-1">Nível de Atividade:</label>
                                    <select id="hydro-activity" class="w-full p-3 border-slate-500 bg-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-white">
                                        <option value="baixo">Baixo</option>
                                        <option value="moderado" selected>Moderado</option>
                                        <option value="alto">Alto</option>
                                    </select>
                                </div>
                            </div>
                            <button id="calculate-hydration" class="w-full bg-blue-600 text-white p-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-blue-700 cta-button">
                                <i class="fas fa-tint"></i> Calcular Consumo de Água
                            </button>
                        </div>
                    </div>
                </div>
                <div id="planner-results" class="mt-8 max-w-4xl mx-auto hidden">
                    <!-- Results will be injected here -->
                </div>
            </div>
        </section>

        <!-- Unidades Section -->
        <section id="unidades" class="py-20 sm:py-28 bg-slate-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Nossas Unidades</h2>
                    <p class="mt-3 text-lg text-slate-600 max-w-2xl mx-auto">Encontre a Betão Gás mais perto de você!</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Unidade Matriz -->
                    <div class="reveal bg-white p-8 rounded-xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold text-blue-600 mb-3">Unidade Matriz</h3>
                        <p class="text-slate-600 mb-4"><i class="fas fa-map-marker-alt mr-2"></i>Av. Dr. Antônio de Castro, 446, Atalaia - Escada/PE</p>
                        <p class="text-slate-800 font-semibold"><i class="fab fa-whatsapp mr-2 text-green-500"></i>(81) 98427-5853</p>
                        <p class="text-slate-800 font-semibold"><i class="fas fa-phone mr-2"></i>(81) 99365-2461</p>
                    </div>
                    <!-- Unidade Filial -->
                    <div class="reveal bg-white p-8 rounded-xl shadow-lg text-center" style="transition-delay: 150ms;">
                        <h3 class="text-2xl font-bold text-blue-600 mb-3">Unidade Filial</h3>
                        <p class="text-slate-600 mb-4"><i class="fas fa-map-marker-alt mr-2"></i>Av. Brasil, 1281, Novo Horizonte - Cabo de Santo Agostinho/PE</p>
                        <p class="text-slate-800 font-semibold"><i class="fab fa-whatsapp mr-2 text-green-500"></i>(81) 98219-5177</p>
                        <p class="text-slate-800 font-semibold"><i class="fas fa-phone mr-2"></i>(81) 99242-7576</p>
                    </div>
                    <!-- Unidade PDV -->
                    <div class="reveal bg-white p-8 rounded-xl shadow-lg text-center" style="transition-delay: 300ms;">
                        <h3 class="text-2xl font-bold text-blue-600 mb-3">Unidade PDV</h3>
                        <p class="text-slate-600 mb-4"><i class="fas fa-map-marker-alt mr-2"></i>R. José Ribeiro, 214, Riacho do Navio - Escada/PE</p>
                        <p class="text-slate-800 font-semibold"><i class="fab fa-whatsapp mr-2 text-green-500"></i>(81) 97347-5406</p>
                        <p class="text-slate-800 font-semibold"><i class="fas fa-phone mr-2"></i>(81) 98981-5365</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sobre Nós Section -->
        <section id="sobre" class="py-20 sm:py-28 bg-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row items-center gap-12 md:gap-16">
                    <div class="md:w-1/2 reveal">
                        <img src="imagens/logo.png" alt="Logo da Betão Gás em destaque" class="rounded-lg shadow-2xl mx-auto w-2/3 md:w-full max-w-sm">
                    </div>
                    <div class="md:w-1/2 text-center md:text-left reveal" style="transition-delay: 200ms;">
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Nossa História</h2>
                        <p class="text-lg font-semibold text-blue-600 mb-4">Revenda Autorizada BRASILGÁS</p>
                        <p class="text-slate-600 mb-4 leading-relaxed">
                            A Betão Gás nasceu do sonho de um homem, o Sr. Roberto, mais conhecido por todos em Escada como "Betão". Há mais de 5 anos, Betão percebeu a necessidade de um serviço de entrega de gás e água que fosse não apenas rápido, mas também confiável e amigável.
                        </p>
                        <p class="text-slate-600 leading-relaxed">
                            Começando com uma pequena moto e muita força de vontade, ele conquistou cliente por cliente com seu carisma e seu compromisso em nunca deixar ninguém na mão. Hoje, a Betão Gás cresceu, mas mantém a mesma essência: tratar cada cliente como um amigo e garantir que a energia e a hidratação nunca faltem nos lares de Escada.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Safety Tips Section -->
        <section id="dicas" class="py-20 sm:py-28 bg-slate-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Dicas e Análise de Segurança</h2>
                    <p class="mt-3 text-lg text-slate-600 max-w-2xl mx-auto">Sua segurança é nossa prioridade. Siga nossas dicas ou peça uma análise personalizada para nossa IA.</p>
                </div>
                <div class="max-w-3xl mx-auto">
                    <div id="accordion-container" class="space-y-4 mb-12">
                        <!-- Accordion items will be injected here by JavaScript -->
                    </div>
                    <div class="reveal bg-white p-8 rounded-2xl text-center shadow-lg">
                        <h3 class="text-2xl font-bold text-slate-800 mb-3">✨ Analisador de Segurança</h3>
                        <p class="text-slate-600 mb-4">Descreva onde você guarda seu botijão e nossa IA especialista fará uma análise de segurança para você.</p>
                        <textarea id="safety-description" rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition mb-4" placeholder="Ex: Meu botijão fica na área de serviço, ao lado do fogão e de uma janela..."></textarea>
                        <button id="analyze-safety" class="w-full bg-green-600 text-white p-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-green-700 cta-button">
                            <i class="fas fa-shield-alt"></i> Analisar Segurança
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center">
            <img src="imagens/logo.png" alt="Logo da Betão Gás" class="h-16 w-auto mx-auto mb-4">
            <p class="mb-4">Betão Gás e Água - Revenda Autorizada BRASILGÁS.</p>
            <div class="flex justify-center space-x-6 mb-8">
                <a href="https://www.instagram.com/betao.gas/" target="_blank" class="text-slate-400 hover:text-white transition-colors"><i class="fab fa-instagram text-2xl"></i></a>
                <a href="https://www.facebook.com/betaogasescada" target="_blank" class="text-slate-400 hover:text-white transition-colors"><i class="fab fa-facebook-f text-2xl"></i></a>
            </div>
            <div class="mb-8">
                <p class="font-semibold mb-4">Formas de Pagamento Aceitas:</p>
                <img src="imagens/pagamentos.png" alt="Formas de Pagamento" class="h-auto max-w-[240px] mx-auto">
            </div>
            <p class="text-slate-500 text-sm">&copy; 2024 Betão Gás e Água. Todos os direitos reservados.</p>
        </div>
    </footer>
    
    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-2xl z-50 transform translate-x-full flex flex-col">
        <!-- Header -->
        <div class="flex justify-between items-center p-5 border-b shrink-0">
            <h3 class="text-2xl font-bold text-slate-900">Seu Pedido</h3>
            <button id="close-cart-button" class="text-slate-500 hover:text-red-500 text-3xl">&times;</button>
        </div>
        
        <!-- Scrollable main content -->
        <div class="flex-grow p-5 overflow-y-auto min-h-0">
            <div id="cart-items">
                <p id="cart-empty-message" class="text-slate-500">Seu carrinho está vazio.</p>
                <!-- Cart items will be injected here -->
            </div>
            
            <!-- Form details (only shown when cart is not empty) -->
            <div id="cart-form-area" class="hidden">
                <div class="space-y-4 my-4 pt-4 border-t">
                    <div>
                        <label for="customer-name" class="block text-sm font-bold mb-1 text-slate-700">Seu Nome:</label>
                        <input type="text" id="customer-name" placeholder="Digite seu nome completo" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div id="delivery-toggle-wrapper" class="hidden">
                        <div class="flex justify-between items-center bg-slate-200 p-3 rounded-lg">
                            <label for="delivery-toggle" class="font-bold text-slate-700">Solicitar Entrega (Frete: R$ 5,00)</label>
                            <label class="switch">
                                <input type="checkbox" id="delivery-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div id="location-details" class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">Localização:</label>
                        <div>
                            <label for="city-select" class="block text-xs font-bold mb-1 text-slate-700">Cidade:</label>
                            <select id="city-select" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></select>
                        </div>
                        <div>
                            <label for="neighborhood-select" class="block text-xs font-bold mb-1 text-slate-700">Bairro:</label>
                            <select id="neighborhood-select" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></select>
                        </div>
                        <div id="other-neighborhood-wrapper" class="hidden">
                             <label for="other-neighborhood-input" class="block text-xs font-bold mb-1 text-slate-700">Qual bairro?</label>
                             <input type="text" id="other-neighborhood-input" placeholder="Digite seu bairro" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </div>
                    </div>
                    <div id="street-address-wrapper" class="hidden">
                        <label for="address" class="block text-sm font-bold mb-1 text-slate-700">Rua e Número:</label>
                        <input type="text" id="address" placeholder="Ex: Rua da Paz, 123" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>
                <div class="mb-4 pt-4 border-t">
                    <label class="block text-sm font-bold mb-2 text-slate-700">Forma de Pagamento:</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button data-payment="Pix" class="payment-option bg-slate-200 text-slate-800 p-2 rounded-lg text-sm hover:bg-blue-500 hover:text-white transition-all duration-200">Pix</button>
                        <button data-payment="Cartão" class="payment-option bg-slate-200 text-slate-800 p-2 rounded-lg text-sm hover:bg-blue-500 hover:text-white transition-all duration-200">Cartão</button>
                        <button data-payment="Dinheiro" class="payment-option bg-slate-200 text-slate-800 p-2 rounded-lg text-sm hover:bg-blue-500 hover:text-white transition-all duration-200">Dinheiro</button>
                    </div>
                    <input type="hidden" id="payment-method">
                </div>
            </div>
        </div>

        <!-- Pinned Footer for Checkout -->
        <div id="cart-checkout-area" class="p-5 border-t bg-slate-50 hidden shrink-0">
            <div class="flex justify-between items-center mb-2">
                <span class="text-slate-600">Subtotal</span>
                <span id="cart-subtotal" class="text-slate-800">R$ 0,00</span>
            </div>
            <div class="flex justify-between items-center mb-4">
                <span class="text-slate-600">Taxa de Entrega</span>
                <span id="cart-delivery-fee" class="text-slate-800">R$ 0,00</span>
            </div>
            <div class="flex justify-between items-center font-bold text-lg mb-4 text-slate-800 border-t pt-2">
                <span>Total:</span>
                <span id="cart-total">R$ 0,00</span>
            </div>
            <button id="checkout-button" class="w-full bg-green-500 text-white p-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2 hover:bg-green-600 cta-button">
                <i class="fab fa-whatsapp"></i> Finalizar Pedido
            </button>
        </div>
    </div>
    <div id="cart-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-40 hidden"></div>

    <!-- AI Response Modal -->
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full flex flex-col" style="max-height: 85vh;">
            <div class="p-6 border-b flex justify-between items-center shrink-0">
                 <h3 id="ai-modal-title" class="text-2xl font-bold text-slate-900">Análise de Segurança</h3>
                 <button id="close-ai-modal" class="text-slate-500 hover:text-red-500 text-3xl">&times;</button>
            </div>
            <div id="ai-modal-content" class="p-6 overflow-y-auto">
                <!-- AI response will be injected here -->
            </div>
        </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-5 right-5 bg-slate-800 text-white py-3 px-5 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-500 z-[100]">
        <p id="notification-message"></p>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Data and Constants ---
    const products = [
        { id: 1, name: 'Gás de Cozinha P13', price: 100.00, description: 'O gás que não te deixa na mão.', icon: 'fa-fire-flame-curved', color: 'red', delivery: true },
        { id: 2, name: 'Gás Industrial P45', price: 420.00, description: 'Para comércios e condomínios.', icon: 'fa-fire-burner', color: 'orange', delivery: false },
        { id: 3, name: 'Gás para Empilhadeira P20', price: 215.00, description: 'Específico para empilhadeiras a gás.', icon: 'fa-truck', color: 'gray', delivery: false },
        { id: 4, name: 'Água Mineral 20L', price: 8.00, description: 'Leveza e saúde para toda a família.', icon: 'fa-tint', color: 'blue', delivery: true },
    ];

    const locations = {
        "Escada": {
            neighborhoods: ["Atalaia", "Riacho do Navio", "Centro", "Jaguaribe", "Viradouro", "Outro"],
            whatsapp: "5581984275853" // Matriz / PDV
        },
        "Cabo de Santo Agostinho": {
            neighborhoods: ["Novo Horizonte", "Centro", "Charneca", "Ponte dos Carvalhos", "Outro"],
            whatsapp: "5581982195177" // Filial
        }
    };

    const safetyTips = [
        { title: 'Instalação Correta do Botijão', content: 'O botijão deve ser instalado em local ventilado, longe de fontes de calor e protegido do sol e da chuva. Nunca instale em locais fechados como armários ou porões.' },
        { title: 'Verificação de Vazamentos', content: 'Após a instalação, passe uma esponja com espuma de sabão na conexão da válvula com o regulador. Se surgirem bolhas, há um vazamento. Não acenda fogo e entre em contato conosco.' },
        { title: 'O que fazer se sentir cheiro de gás?', content: 'Não acenda luzes nem risque fósforos. Abra todas as portas e janelas para ventilar o ambiente. Feche o registro do gás. Se o cheiro persistir, retire as pessoas do local e chame os bombeiros (193) e a Betão Gás.' },
        { title: 'Validade da Mangueira e Regulador', content: 'Verifique a data de validade impressa na mangueira e no regulador de pressão (registro). Eles devem ser trocados a cada 5 anos ou conforme a indicação do fabricante.' },
    ];
    
    let cart = [];
    const colorMap = { red: 'red-500', blue: 'blue-500', orange: 'orange-500', gray: 'slate-500' };

    // --- DOM Elements ---
    const productList = document.getElementById('product-list');
    const cartButton = document.getElementById('cart-button');
    const closeCartButton = document.getElementById('close-cart-button');
    const cartSidebar = document.getElementById('cart-sidebar');
    const cartOverlay = document.getElementById('cart-overlay');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartCounter = document.getElementById('cart-counter');
    const cartSubtotal = document.getElementById('cart-subtotal');
    const cartDeliveryFee = document.getElementById('cart-delivery-fee');
    const cartTotal = document.getElementById('cart-total');
    const cartFormArea = document.getElementById('cart-form-area');
    const cartCheckoutArea = document.getElementById('cart-checkout-area');
    const checkoutButton = document.getElementById('checkout-button');
    const customerNameInput = document.getElementById('customer-name');
    const addressInput = document.getElementById('address');
    const paymentMethodInput = document.getElementById('payment-method');
    const paymentOptionButtons = document.querySelectorAll('.payment-option');
    const accordionContainer = document.getElementById('accordion-container');
    const header = document.getElementById('header');
    const deliveryToggleWrapper = document.getElementById('delivery-toggle-wrapper');
    const deliveryToggle = document.getElementById('delivery-toggle');
    const locationDetails = document.getElementById('location-details');
    const streetAddressWrapper = document.getElementById('street-address-wrapper');
    const citySelect = document.getElementById('city-select');
    const neighborhoodSelect = document.getElementById('neighborhood-select');
    const otherNeighborhoodWrapper = document.getElementById('other-neighborhood-wrapper');
    const otherNeighborhoodInput = document.getElementById('other-neighborhood-input');
    
    // Gemini Feature Elements
    const plannerResultsContainer = document.getElementById('planner-results');
    const calculateHydrationButton = document.getElementById('calculate-hydration');
    const generateRecipeButton = document.getElementById('generate-recipe');
    const analyzeSafetyButton = document.getElementById('analyze-safety');
    const safetyDescriptionInput = document.getElementById('safety-description');
    const aiModal = document.getElementById('ai-modal');
    const aiModalTitle = document.getElementById('ai-modal-title');
    const aiModalContent = document.getElementById('ai-modal-content');
    const closeAiModalButton = document.getElementById('close-ai-modal');
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = {
        'gas-duration': document.getElementById('gas-duration-tab-content'),
        'recipe': document.getElementById('recipe-tab-content'),
        'hydration': document.getElementById('hydration-tab-content')
    };
    const calculateGasDurationButton = document.getElementById('calculate-gas-duration');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuIcon = document.getElementById('mobile-menu-icon');

    // Notification Elements
    const notificationToast = document.getElementById('notification-toast');
    const notificationMessage = document.getElementById('notification-message');
    let notificationTimeout;


    // --- Gemini API Function ---
    async function callGemini(prompt, isJson = false) {
        const apiKey = "AIzaSyCafcvcSSve2n-6hGQ_3VIxsR4pKEcgNX4"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }],
        };

        if (isJson) {
            payload.generationConfig = {
                responseMimeType: "application/json",
            };
        }

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                const content = result.candidates[0].content.parts[0].text;
                return content;
            } else {
                console.warn("API response structure is unexpected:", result);
                throw new Error("Resposta inválida ou vazia da API.");
            }
        } catch (error) {
            console.error("Erro ao chamar a API Gemini:", error);
            // Show a user-friendly error message
            showNotification('Erro de comunicação com o assistente.', 'error');
            return null;
        }
    }

    // --- UI Functions ---
    
    /**
     * Displays a toast notification at the bottom-right of the screen.
     * @param {string} message The message to display.
     * @param {'info' | 'success' | 'warning' | 'error'} type The type of notification, for styling.
     */
    function showNotification(message, type = 'info') {
        clearTimeout(notificationTimeout);

        notificationMessage.textContent = message;
        notificationToast.className = 'fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-xl transform transition-all duration-500 z-[100]'; // Reset classes
        
        switch (type) {
            case 'error':
                notificationToast.classList.add('bg-red-600');
                break;
            case 'warning':
                notificationToast.classList.add('bg-yellow-500', 'text-slate-800');
                break;
            case 'success':
                 notificationToast.classList.add('bg-green-600');
                 break;
            default:
                notificationToast.classList.add('bg-slate-800');
                break;
        }

        notificationToast.classList.add('translate-y-0', 'opacity-100');
        notificationToast.classList.remove('translate-y-20', 'opacity-0');

        notificationTimeout = setTimeout(() => {
            notificationToast.classList.remove('translate-y-0', 'opacity-100');
            notificationToast.classList.add('translate-y-20', 'opacity-0');
        }, 4000);
    }

    function showLoading(container) {
        container.innerHTML = '<div class="flex justify-center items-center p-8"><div class="loader"></div></div>';
        if (container !== aiModalContent) {
             plannerResultsContainer.style.display = 'block';
        }
    }

    function renderProducts() {
        productList.innerHTML = '';
        products.forEach((product, index) => {
            const cardColor = colorMap[product.color] || 'slate-500';
            
            const imageOrIcon = product.image
                ? `<img src="${product.image}" alt="${product.name}" class="h-20 mx-auto mb-4 object-contain">`
                : `<div class="text-${cardColor} mb-4"><i class="fas ${product.icon} text-5xl"></i></div>`;

            const productCard = `
                <div class="reveal bg-white rounded-xl shadow-lg overflow-hidden flex flex-col text-center transform transition-all duration-300 hover:scale-105 hover:shadow-2xl" style="transition-delay: ${index * 100}ms;">
                    <div class="p-6 border-t-4 border-${cardColor} flex flex-col flex-grow">
                        ${imageOrIcon}
                        <h3 class="text-xl font-bold text-slate-900 mb-2">${product.name}</h3>
                        <p class="text-slate-600 flex-grow mb-4 text-sm">${product.description}</p>
                        <div class="mt-auto">
                            <p class="text-2xl font-bold text-slate-800 mb-5">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                            <button data-id="${product.id}" class="add-to-cart-btn bg-blue-600 text-white font-bold py-3 px-6 rounded-lg w-full hover:bg-blue-700 cta-button">
                                Adicionar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            productList.innerHTML += productCard;
        });
    }

    function renderSafetyTips() {
        accordionContainer.innerHTML = '';
        safetyTips.forEach((tip, index) => {
            const accordionItem = `
                <div class="reveal border border-slate-200 rounded-lg bg-white" style="transition-delay: ${index * 100}ms;">
                    <button class="accordion-toggle w-full text-left p-5 font-semibold text-slate-800 flex justify-between items-center hover:bg-slate-50 transition-colors">
                        <span>${tip.title}</span>
                        <i class="fas fa-chevron-down transition-transform duration-300"></i>
                    </button>
                    <div class="accordion-content px-5 pb-5 text-slate-600">
                        <p>${tip.content}</p>
                    </div>
                </div>
            `;
            accordionContainer.innerHTML += accordionItem;
        });
    }

    function toggleCart() {
        cartSidebar.classList.toggle('cart-open');
        cartOverlay.classList.toggle('hidden');
    }

    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        const existingProduct = cart.find(item => item.id === productId);

        if (existingProduct) {
            existingProduct.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        
        showNotification(`${product.name} adicionado ao carrinho!`, 'success');
        cartButton.classList.add('cart-jump-animation');
        setTimeout(() => cartButton.classList.remove('cart-jump-animation'), 500);

        updateCart();
    }
    
    function updateQuantity(productId, newQuantity) {
        const itemInCart = cart.find(item => item.id === productId);
        if (itemInCart) {
            if (newQuantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            } else {
                itemInCart.quantity = newQuantity;
            }
        }
        updateCart();
    }

    function updateCart() {
        // Ensure the list container exists, or create it
        let itemsListContainer = cartItemsContainer.querySelector('#cart-items-list');
        if (!itemsListContainer) {
            itemsListContainer = document.createElement('div');
            itemsListContainer.id = 'cart-items-list';
            cartItemsContainer.appendChild(itemsListContainer);
        }

        const deliveryFee = 5.00;
        const isDeliveryEligible = cart.some(item => item.delivery);
        const wantsDelivery = deliveryToggle.checked && isDeliveryEligible;

        deliveryToggleWrapper.classList.toggle('hidden', !isDeliveryEligible);
        if (!isDeliveryEligible) {
            deliveryToggle.checked = false;
        }
        streetAddressWrapper.classList.toggle('hidden', !deliveryToggle.checked);

        if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p id="cart-empty-message" class="text-slate-500">Seu carrinho está vazio.</p>';
            cartFormArea.style.display = 'none';
            cartCheckoutArea.style.display = 'none';
        } else {
            cartFormArea.style.display = 'block';
            cartCheckoutArea.style.display = 'block';
            const emptyMsg = cartItemsContainer.querySelector('#cart-empty-message');
            if (emptyMsg) emptyMsg.style.display = 'none';
            
            itemsListContainer.innerHTML = ''; // Clear only the list
            cart.forEach(item => {
                const cartItemHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex-grow pr-4">
                            <p class="font-bold text-slate-800">${item.name}</p>
                            <p class="text-sm text-slate-600">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button data-id="${item.id}" class="quantity-btn decrease-btn bg-slate-200 rounded-md w-7 h-7 font-bold hover:bg-slate-300">-</button>
                            <span class="font-bold w-5 text-center">${item.quantity}</span>
                            <button data-id="${item.id}" class="quantity-btn increase-btn bg-slate-200 rounded-md w-7 h-7 font-bold hover:bg-slate-300">+</button>
                        </div>
                    </div>
                `;
                itemsListContainer.innerHTML += cartItemHTML;
            });
        }

        const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const finalDeliveryFee = wantsDelivery ? deliveryFee : 0;
        const total = subtotal + finalDeliveryFee;
        
        cartSubtotal.textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
        cartDeliveryFee.textContent = `R$ ${finalDeliveryFee.toFixed(2).replace('.', ',')}`;
        cartTotal.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        cartCounter.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    function handleCheckout() {
        const customerName = customerNameInput.value.trim();
        const paymentMethod = paymentMethodInput.value;
        const wantsDelivery = deliveryToggle.checked;
        const deliveryFee = 5.00;
        const city = citySelect.value;
        let neighborhood = neighborhoodSelect.value;
        const hasSpecialGas = cart.some(item => !item.delivery);

        if (cart.length === 0) { showNotification('Seu carrinho está vazio!', 'warning'); return; }
        if (!customerName) { showNotification('Por favor, informe seu nome.', 'error'); customerNameInput.focus(); return; }
        if (!city) { showNotification('Por favor, selecione a cidade.', 'error'); return; }

        let whatsappNumber = locations[city]?.whatsapp || locations['Escada'].whatsapp;
        let fullAddress = '';
        
        if (neighborhood === 'Outro') {
            neighborhood = otherNeighborhoodInput.value.trim();
            if (!neighborhood) {
                showNotification('Por favor, digite o nome do seu bairro.', 'error');
                otherNeighborhoodInput.focus();
                return;
            }
        }
        
        if (!neighborhood) { showNotification('Por favor, selecione o bairro.', 'error'); return; }

        if (wantsDelivery) {
            const streetAddress = addressInput.value.trim();
            if (!streetAddress) {
                showNotification('Para entrega, preencha a Rua e o Número.', 'error');
                addressInput.focus();
                return;
            }
            fullAddress = `${streetAddress}, ${neighborhood}, ${city}`;
        }
        
        if (!paymentMethod) { showNotification('Por favor, escolha uma forma de pagamento.', 'error'); return; }

        let message = `Olá *Betão Gás*! ⛽💧\n\nMeu nome é *${customerName}* e gostaria de fazer o seguinte pedido:\n\n`;
        cart.forEach(item => { message += `▪️ ${item.quantity}x ${item.name}\n`; });
        
        const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const finalDeliveryFee = wantsDelivery ? deliveryFee : 0;
        const total = subtotal + finalDeliveryFee;

        message += `\n*Subtotal:* R$ ${subtotal.toFixed(2).replace('.', ',')}\n`;
        if (wantsDelivery) {
            message += `*Taxa de Entrega:* R$ ${finalDeliveryFee.toFixed(2).replace('.', ',')}\n`;
            message += `*Endereço de Entrega:*\n${fullAddress}\n`;
        } else {
            message += `*Modalidade:* Retirada na portaria\n`;
            message += `*Unidade para Retirada:* ${city} (${neighborhood})\n`;
        }
        if (hasSpecialGas) {
            message += `\n*Atenção:* O pedido contém itens industriais. A entrega será combinada.\n`;
        }
        message += `\n*Forma de Pagamento:*\n${paymentMethod}\n`;
        message += `\n*TOTAL DO PEDIDO: R$ ${total.toFixed(2).replace('.', ',')}*`;

        const encodedMessage = encodeURIComponent(message);
        window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
    }

    function handleScroll() {
        const isMenuOpen = !mobileMenu.classList.contains('hidden');
        if (window.scrollY > 50 || isMenuOpen) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
    }

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    // --- Gemini Feature Functions ---
    async function handleGasEstimation() {
        const people = document.getElementById('gas-people').value;
        const frequency = document.getElementById('gas-frequency').value;
        
        showLoading(plannerResultsContainer);
        
        const prompt = `Você é um especialista em consumo de gás GLP. Estime a duração de um botijão de gás P13 (13kg) para uma residência com ${people} pessoas que cozinham ${frequency}. Forneça uma resposta em JSON com as chaves: "estimativa" (string, ex: 'entre 4 e 6 semanas'), e "dica" (uma dica de economia de gás em português).`;
        
        const result = await callGemini(prompt, true);
        
        if (result) {
            try {
                const data = JSON.parse(result);
                let html = `<div class="bg-slate-100 p-8 rounded-2xl text-slate-800 text-left">`;
                html += `<h3 class="text-2xl font-bold mb-6 text-center">🔥 Estimativa de Duração do Gás</h3>`;
                html += `<p class="text-center text-lg mb-4">Para sua casa, a estimativa é que um botijão dure:</p>`;
                html += `<p class="text-center text-4xl font-bold text-orange-500 mb-6">${data.estimativa}</p>`;
                html += `<div class="mt-6 p-4 bg-orange-100 text-orange-800 rounded-lg"><i class="fas fa-lightbulb mr-2"></i><strong>Dica de Economia:</strong> ${data.dica}</div>`;
                html += `</div>`;
                plannerResultsContainer.innerHTML = html;
            } catch(e) {
                console.error("JSON Parsing Error:", e);
                plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Houve um erro ao processar a estimativa. Tente novamente.</p>`;
            }
        } else {
            plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Não foi possível obter uma estimativa. Verifique sua conexão e tente novamente.</p>`;
        }
    }

    async function handleHydrationCalculation() {
        const adults = document.getElementById('hydro-adults').value;
        const children = document.getElementById('hydro-children').value;
        const activity = document.getElementById('hydro-activity').value;
        
        if (adults < 1 && children < 1) {
            showNotification("Por favor, insira pelo menos 1 pessoa.", 'warning');
            return;
        }

        showLoading(plannerResultsContainer);
        
        const prompt = `Você é um assistente de saúde e bem-estar. Calcule a necessidade de galões de água de 20L por mês para uma família com ${adults} adultos e ${children} crianças. Considere que o nível de atividade deles é '${activity}'. Forneça uma resposta em JSON com as chaves: "galoes_mes" (número), "litros_dia_total" (número), e "dica" (uma dica de saúde sobre hidratação em português).`;
        
        const result = await callGemini(prompt, true);
        
        if (result) {
            try {
                const data = JSON.parse(result);
                let html = `<div class="bg-slate-100 p-8 rounded-2xl text-slate-800 text-left">`;
                html += `<h3 class="text-2xl font-bold mb-6 text-center">💧 Plano de Hidratação Familiar</h3>`;
                html += `<p class="text-center text-lg mb-4">Sua família precisa de aproximadamente <strong>${data.litros_dia_total.toFixed(1)} litros</strong> de água por dia.</p>`;
                html += `<p class="text-center text-4xl font-bold text-blue-600 mb-4">${Math.ceil(data.galoes_mes)}</p>`;
                html += `<p class="text-center text-lg mb-6">Galões de 20L por mês</p>`;
                html += `<div class="mt-6 p-4 bg-blue-100 text-blue-800 rounded-lg"><i class="fas fa-lightbulb mr-2"></i><strong>Dica de Saúde:</strong> ${data.dica}</div>`;
                html += `</div>`;
                plannerResultsContainer.innerHTML = html;
            } catch(e) {
                console.error("JSON Parsing Error:", e);
                plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Houve um erro ao processar a sugestão. Tente novamente.</p>`;
            }
        } else {
            plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Não foi possível obter uma sugestão. Verifique sua conexão e tente novamente.</p>`;
        }
    }

    async function handleRecipeGeneration() {
        const mealType = document.getElementById('recipe-type').value;
        const mainIngredient = document.getElementById('recipe-ingredient').value;
        if (!mainIngredient) {
            showNotification("Por favor, insira um ingrediente principal.", 'warning');
            return;
        }

        showLoading(plannerResultsContainer);

        const prompt = `Você é um chef de cozinha criativo. Sugira uma receita deliciosa e prática para ser feita no fogão a gás. O tipo de refeição é '${mealType}'. O ingrediente principal é '${mainIngredient}'. Forneça uma resposta em JSON com as chaves: "nome_receita" (string), "ingredientes" (array de strings), "modo_preparo" (array de strings), e "dica_chef" (string). A resposta deve ser em português.`;

        const result = await callGemini(prompt, true);

        if (result) {
            try {
                const data = JSON.parse(result);
                let html = `<div class="bg-slate-100 p-8 rounded-2xl text-slate-800 text-left">`;
                html += `<h3 class="text-2xl font-bold mb-4 text-center">🍳 ${data.nome_receita}</h3>`;
                
                html += `<h4 class="font-bold text-lg mb-2 mt-6"><i class="fas fa-carrot mr-2 text-orange-500"></i>Ingredientes:</h4><ul class="list-disc list-inside mb-4 space-y-1">`;
                data.ingredientes.forEach(item => { html += `<li>${item}</li>`; });
                html += `</ul>`;

                html += `<h4 class="font-bold text-lg mb-2 mt-6"><i class="fas fa-blender mr-2 text-gray-500"></i>Modo de Preparo:</h4><ol class="list-decimal list-inside mb-4 space-y-2">`;
                data.modo_preparo.forEach(item => { html += `<li>${item}</li>`; });
                html += `</ol>`;

                html += `<div class="mt-6 p-4 bg-red-100 text-red-800 rounded-lg"><i class="fas fa-lightbulb mr-2"></i><strong>Dica do Chef:</strong> ${data.dica_chef}</div>`;
                html += `</div>`;
                plannerResultsContainer.innerHTML = html;
            } catch(e) {
                console.error("JSON Parsing Error:", e);
                plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Houve um erro ao gerar a receita. Tente novamente.</p>`;
            }
        } else {
            plannerResultsContainer.innerHTML = `<p class="text-red-400 text-center">Não foi possível gerar a receita. Verifique sua conexão e tente novamente.</p>`;
        }
    }

    async function handleSafetyAnalysis() {
        const description = safetyDescriptionInput.value.trim();
        if (!description) {
            showNotification("Por favor, descreva onde você guarda o botijão.", 'warning');
            return;
        }

        aiModal.style.display = 'flex';
        showLoading(aiModalContent);

        const prompt = `Você é um especialista em segurança de gás GLP para o Brasil, seguindo as normas da ABNT e do Corpo de Bombeiros. Analise a seguinte descrição do local de armazenamento de um botijão de gás e forneça uma resposta em HTML. A resposta deve ser amigável, clara, e objetiva. Use uma lista de bullet points (<ul> e <li>) para os pontos de atenção. Comece a resposta com um título H3 'Análise de Segurança do nosso Especialista'. No final, adicione uma nota de rodapé em negrito e itálico dizendo: 'Esta é uma análise gerada por IA. Em caso de dúvida, sempre consulte um profissional qualificado.' Descrição do usuário: "${description}"`;

        const result = await callGemini(prompt);

        if (result) {
            aiModalTitle.textContent = "Análise de Segurança";
            aiModalContent.innerHTML = result;
        } else {
            aiModalTitle.textContent = "Erro na Análise";
            aiModalContent.innerHTML = `<p class="text-red-500">Não foi possível realizar a análise no momento. Por favor, tente novamente mais tarde.</p>`;
        }
    }
    
    function populateCities() {
        citySelect.innerHTML = '<option value="">Selecione a Cidade</option>';
        for (const city in locations) {
            citySelect.innerHTML += `<option value="${city}">${city}</option>`;
        }
    }

    function updateNeighborhoods() {
        const selectedCity = citySelect.value;
        neighborhoodSelect.innerHTML = '<option value="">Selecione o Bairro</option>';
        otherNeighborhoodWrapper.classList.add('hidden');
        if (selectedCity && locations[selectedCity]) {
            locations[selectedCity].neighborhoods.forEach(neighborhood => {
                neighborhoodSelect.innerHTML += `<option value="${neighborhood}">${neighborhood}</option>`;
            });
        }
    }

    // --- Event Listeners ---
    cartButton.addEventListener('click', toggleCart);
    closeCartButton.addEventListener('click', toggleCart);
    cartOverlay.addEventListener('click', toggleCart);
    checkoutButton.addEventListener('click', handleCheckout);
    window.addEventListener('scroll', handleScroll);
    calculateHydrationButton.addEventListener('click', handleHydrationCalculation);
    generateRecipeButton.addEventListener('click', handleRecipeGeneration);
    analyzeSafetyButton.addEventListener('click', handleSafetyAnalysis);
    calculateGasDurationButton.addEventListener('click', handleGasEstimation);
    
    // Modal closing logic
    closeAiModalButton.addEventListener('click', () => aiModal.style.display = 'none');
    aiModal.addEventListener('click', (e) => {
        if (e.target === aiModal) { // Close only if clicking on the overlay itself
            aiModal.style.display = 'none';
        }
    });

    // Mobile Menu Toggle
    mobileMenuButton.addEventListener('click', () => {
        const isOpening = mobileMenu.classList.contains('hidden');
        mobileMenu.classList.toggle('hidden');
        
        if (isOpening) {
            mobileMenuIcon.classList.remove('fa-bars');
            mobileMenuIcon.classList.add('fa-times');
            header.classList.add('mobile-menu-open', 'scrolled');
        } else {
            mobileMenuIcon.classList.remove('fa-times');
            mobileMenuIcon.classList.add('fa-bars');
            header.classList.remove('mobile-menu-open');
            // Re-check scroll position after closing
            handleScroll();
        }
    });
    
    // Close mobile menu when a link is clicked
    document.querySelectorAll('.mobile-nav-link').forEach(link => {
        link.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            mobileMenuIcon.classList.remove('fa-times');
            mobileMenuIcon.classList.add('fa-bars');
            header.classList.remove('mobile-menu-open');
            handleScroll();
        });
    });

    deliveryToggle.addEventListener('change', updateCart);
    citySelect.addEventListener('change', updateNeighborhoods);
    neighborhoodSelect.addEventListener('change', () => {
        otherNeighborhoodWrapper.classList.toggle('hidden', neighborhoodSelect.value !== 'Outro');
    });
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            Object.values(tabContents).forEach(content => content.style.display = 'none');
            tabContents[button.dataset.tab].style.display = 'block';
            plannerResultsContainer.style.display = 'none'; // Hide results when switching tabs
        });
    });
    
    productList.addEventListener('click', (e) => {
        const button = e.target.closest('.add-to-cart-btn');
        if (button) {
            addToCart(parseInt(button.dataset.id));
        }
    });
    
    cartItemsContainer.addEventListener('click', (e) => {
        const button = e.target.closest('.quantity-btn');
        if (button) {
            const productId = parseInt(button.dataset.id);
            const itemInCart = cart.find(item => item.id === productId);
            if (!itemInCart) return;
            let newQuantity = itemInCart.quantity;
            if (button.classList.contains('increase-btn')) newQuantity++;
            else if (button.classList.contains('decrease-btn')) newQuantity--;
            updateQuantity(productId, newQuantity);
        }
    });
    
    paymentOptionButtons.forEach(button => {
        button.addEventListener('click', () => {
            paymentOptionButtons.forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-slate-200', 'text-slate-800');
            });
            button.classList.add('bg-blue-600', 'text-white');
            button.classList.remove('bg-slate-200', 'text-slate-800');
            paymentMethodInput.value = button.dataset.payment;
        });
    });

    accordionContainer.addEventListener('click', (e) => {
        const toggle = e.target.closest('.accordion-toggle');
        if (toggle) {
            const icon = toggle.querySelector('i');
            const content = toggle.nextElementSibling;
            const isOpening = !content.style.maxHeight || content.style.maxHeight === "0px";

            // Close all other accordions
            document.querySelectorAll('.accordion-content').forEach(el => {
                if (el !== content) {
                    el.style.maxHeight = null;
                    el.previousElementSibling.querySelector('i').classList.remove('rotate-180');
                }
            });

            // Open or close the clicked one
            if (isOpening) {
                icon.classList.add('rotate-180');
                content.style.maxHeight = content.scrollHeight + "px";
            } else {
                icon.classList.remove('rotate-180');
                content.style.maxHeight = null;
            }
        }
    });

    // --- Initialization ---
    function initializeTabs() {
        // Set initial state
        document.querySelector('.tab-button[data-tab="gas-duration"]').classList.add('active');
        Object.values(tabContents).forEach(content => content.style.display = 'none');
        tabContents['gas-duration'].style.display = 'block';
    }

    renderProducts();
    renderSafetyTips();
    updateCart();
    populateCities();
    updateNeighborhoods();
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    handleScroll();
    initializeTabs();
});
</script>

</body>
</html>
